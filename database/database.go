package database

////////////////////////////////////////////////////////////////////////////////////////////////
/// Imports
////////////////////////////////////////////////////////////////////////////////////////////////

import (
    "github.com/helyx-io/commute-importer/config"
    "github.com/jinzhu/gorm"
)


////////////////////////////////////////////////////////////////////////////////////////////////
/// Structures
////////////////////////////////////////////////////////////////////////////////////////////////

func InitDB(dbInfos *config.DBConnectInfos) (*gorm.DB, error) {
    db, err := gorm.Open(dbInfos.Dialect, dbInfos.URL)

    if err != nil {
        return nil, err
    }

    db.DB()

    // Then you could invoke `*sql.DB`'s functions with it
    db.DB().Ping()

    db.DB().SetMaxIdleConns(dbInfos.MaxIdelConns)
    db.DB().SetMaxOpenConns(dbInfos.MaxOpenConns)

    db.SingularTable(true)

    return &db, nil
}
